# 2.12 â€” RBAC & PERMISSIONS (MATRIX) â€” V1

**Statut** : DRAFT (devient LOCKED aprÃ¨s validation)
**Version** : 1.0
**DerniÃ¨re mise Ã  jour** : 2026-02-15

**Objectif** : DÃ©finir de maniÃ¨re contractuelle **qui peut faire quoi**, **sur quels endpoints**, dans un contexte **multi-tenant, RegTech, inspection-ready**.

**RÃ¨gle absolue** :

- Toute Ã©volution dâ€™endpoint â‡’ update RBAC
- Toute Ã©volution RBAC â‡’ update OpenAPI + changelog
- Aucune permission implicite

---

## 2.12.1 RÃ´les officiels (LOCKED V1)

| RÃ´le | Description |
| --- | --- |
| tenant_admin | Administrateur du tenant (agence) |
| agency_user | Utilisateur opÃ©rationnel agence |
| consultant | Prospection / RFP / allocation |
| client_user | Client final (lecture limitÃ©e) |
| worker | IntÃ©rimaire (PWA mobile-first) |
| system | Jobs internes / enforcement / batch |

---

## 2.12.2 Principes de sÃ©curitÃ© (OBLIGATOIRES)

- Tous les accÃ¨s sont **tenant-scoped**
- `client_user` et `worker` = **lecture strictement limitÃ©e**
- Les dÃ©cisions critiques (enforcement, issue invoice) = **jamais client / worker**
- Le no-code **ne bypass jamais** le RBAC

---

## 2.12.3 RBAC â€” Parcours 1

### Mission â†’ Compliance Case â†’ Enforcement

### Missions (M7)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /missions | âœ… | âœ… | âœ… | âŒ | âŒ |
| PATCH /missions/{id}/status | âœ… | âœ… | âŒ | âŒ | âŒ |
| GET /missions/{id} | âœ… | âœ… | âœ… (scoped) | ğŸ‘ï¸ | âŒ |

---

### Compliance Case (M8)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| GET /missions/{id}/compliance-case | âœ… | âœ… | âœ… | ğŸ‘ï¸ | âŒ |
| POST /missions/{id}/compliance-case/requirements/initialize | âœ… | âœ… | âŒ | âŒ | âŒ |
| GET /compliance-cases/{id}/requirements | âœ… | âœ… | âœ… | âŒ | ğŸ‘ï¸ (own only) |
| PATCH /requirements/{id}/status | âœ… | âœ… | âŒ | âŒ | âŒ |

---

### A1 (assistÃ© V1)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /compliance-cases/{id}/a1-requests | âœ… | âœ… | âŒ | âŒ | âŒ |
| PATCH /a1-requests/{id}/status | âœ… | âœ… | âŒ | âŒ | âŒ |

---

### Remuneration (M8)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /compliance-cases/{id}/remuneration/inputs | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /compliance-cases/{id}/remuneration/snapshots:calculate | âœ… | âœ… | âŒ | âŒ | âŒ |

---

### Enforcement (M8)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| GET /missions/{id}/enforcement | âœ… | âœ… | ğŸ‘ï¸ | ğŸ‘ï¸ | âŒ |
| POST /missions/{id}/enforcement:evaluate | âœ… | âŒ | âŒ | âŒ | âŒ |

---

## 2.12.4 RBAC â€” Parcours 3

### Timesheet â†’ Invoice â†’ Payment

### Timesheets (M7)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /missions/{id}/timesheets | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /timesheets/{id}/entries | âœ… | âœ… | âŒ | âŒ | âœ… (own only) |
| POST /timesheets/{id}:submit | âœ… | âœ… | âŒ | âŒ | âœ… (own only) |
| POST /timesheets/{id}:validate | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /timesheets/{id}:reject | âœ… | âœ… | âŒ | âœ… (si double validation activÃ©e) | âŒ |

---

### Invoices (M10) â€” Mode C / C1

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /invoices:from-timesheet | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /invoices/{id}:issue | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /invoices/{id}:block | âœ… | âŒ | âŒ | âŒ | âŒ |
| POST /invoices/{id}:void | âœ… | âŒ | âŒ | âŒ | âŒ |
| PATCH /timesheets/{id}/billing-status | âœ… | âœ… | âŒ | âŒ | âŒ |

---

### Payments (M10)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /payments | âœ… | âœ… | âŒ | âŒ | âŒ |

---

## 2.12.5 RBAC â€” Parcours 2

### CRM â†’ RFP â†’ Allocation

### Leads & Clients (M2 / M3)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /leads | âœ… | âœ… | âœ… | âŒ | âŒ |
| PATCH /leads/{id}/status | âœ… | âœ… | âœ… | âŒ | âŒ |
| GET /leads | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /leads/{id}:convert-to-client | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /clients | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /clients/{id}/sites | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /clients/{id}/documents | âœ… | âœ… | âŒ | âŒ | âŒ |

---

### RFP (M4)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /rfps | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /rfps/{id}:publish | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /rfps/{id}/invites | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /rfps/{id}/responses | âœ… | âœ… (agence invitÃ©e) | âŒ | âŒ | âŒ |
| POST /rfps/{id}:allocate | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /rfps/{id}:create-mission-draft | âœ… | âœ… | âœ… | âŒ | âŒ |

---

## 2.12.6 RBAC â€” Tasks & Agency Profile

### Tasks (V1.1)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| POST /tasks | âœ… | âœ… | âœ… | âŒ | âŒ |
| PATCH /tasks/{id}/status | âœ… | âœ… | âœ… | âŒ | âŒ |
| GET /tasks | âœ… | âœ… | âœ… | âŒ | âŒ |

---

### Agency Profile (V1.1)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
| --- | --- | --- | --- | --- | --- |
| PATCH /agency-profile | âœ… | âŒ | âŒ | âŒ | âŒ |

---

## 2.12.7 RÃ¨gles finales (ANTI-CHAOS)

- `client_user` et `worker` = **aucune Ã©criture mÃ©tier critique**
- `system` peut appeler uniquement :
    - enforcement:evaluate
    - batch expirations
    - recalcul snapshots
- Toute tentative hors RBAC â‡’ **403 + audit_log**

## 2.12.8 RBAC Manquant : M5 (ATS) et M6 (Workers)

### ATS â€” Job Offers & Applications (M5)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
|---|---|---|---|---|---|
| POST /v1/job-offers | âœ… | âœ… | âŒ | âŒ | âŒ |
| PATCH /v1/job-offers/{id}/status | âœ… | âœ… | âŒ | âŒ | âŒ |
| GET /v1/job-offers | âœ… | âœ… | âœ… | âŒ | âŒ |
| POST /v1/applications | âœ… | âœ… | âœ… | âŒ | âŒ |
| PATCH /v1/applications/{id}/status | âœ… | âœ… | âŒ | âŒ | âŒ |
| GET /v1/applications | âœ… | âœ… | âœ… (scoped) | âŒ | âŒ |
| POST /v1/applications/{id}:shortlist | âœ… | âœ… | âŒ | âŒ | âŒ |

### Workers & Documents (M6)

| Endpoint | tenant_admin | agency_user | consultant | client_user | worker |
|---|---|---|---|---|---|
| POST /v1/workers | âœ… | âœ… | âŒ | âŒ | âŒ |
| GET /v1/workers/{id} | âœ… | âœ… | âœ… (scoped) | âŒ | ğŸ‘ï¸ (own only) |
| PATCH /v1/workers/{id} | âœ… | âœ… | âŒ | âŒ | âŒ |
| POST /v1/workers/{id}/documents | âœ… | âœ… | âŒ | âŒ | âœ… (own only, upload only) |
| GET /v1/workers/{id}/documents | âœ… | âœ… | âœ… (scoped) | âŒ | ğŸ‘ï¸ (own only) |


---

## Changelog doc

- 2026-02-17: Alignement RBAC â†” OpenAPI, sans changement mÃ©tier.

---

FIN â€” RBAC V1
